<!DOCTYPE html>
<html>
{% load staticfiles %}
<head>
	<title>Dashboard</title>
	<meta name="viewport" content="width=device-width">
	<link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4.1.3\bootstrap-4.1.3\dist\css\bootstrap.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<script type="text/javascript" src="{% static 'bootstrap-4.1.3\bootstrap-4.1.3\dist\js\bootstrap.min.js' %}"></script>

	<script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="{% static 'js/index.js' %}"></script>

</head>
<body>
<div class="main">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand mr-lg-6" href="#">Bee Portal</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active mr-lg-4 ml-lg-4">
        <a class="nav-link" href="#">Dashboard <span class="sr-only">(current)</span></a>
      </li>
      
      <li class="nav-item dropdown mr-lg-4 ml-lg-4">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Portfolio
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item mr-lg-4 ml-lg-4">
        <a class="nav-link" href="#">News</a>
      </li>
      <li class="nav-item mr-lg-4 ml-lg-4">
        <a class="nav-link disabled" href="#">Bench</a>
      </li>
      <li class="nav-item mr-lg-4 ml-lg-4">
        <a class="nav-link disabled" href="#">Payloads</a>
      </li>
      <li class="nav-item mr-lg-4 ml-lg-4">
        <a class="nav-link disabled" href="#">Forum</a>
      </li>
    </ul>
    <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
    	<li class="nav-item dropdown ml-lg-4">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Tim Smith
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
    </ul>
  </div>
</nav>

	<div class="container-fluid">
	<div class="row">
	<div class="col-lg-12 col-md-12 col-sm-12">

	  <div class="container-fluid mt-3">
		  <button type="button" aria-expanded="true" class="btn btn-primary dealflow-btn" data-toggle="collapse" data-target="#demo"><img class="drp-arw" src="{% static 'img/arrow.png' %}"> Dealflow Metrics</button>

		   <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
		      THROUGHPUT: 12 DAYS 
		    </button>

		    <input type="number" class="form-control number-inp" id="number">

		    <div class="dropdown-menu">
		      <a class="dropdown-item" href="#">Link 1</a>
		      <a class="dropdown-item" href="#">Link 2</a>
		      <a class="dropdown-item" href="#">Link 3</a>
		    </div>
		    </div>
		    </div>
	  <div class="col-lg-5 col-md-12 col-sm-12">

	  <div class="container mt-3">
		  <div id="demo" class="collapse mt-3">
			    <table class="table table-striped">
				    <thead>
                      <tr>
				        <th>DEADFLOW STAGE</th>
				        <th>COUNT</th>
				        <th>AVG DAYS</th>
				      </tr>
				    </thead>
				    <tbody>
				        {% for stage in stage_count %}
                            <tr>
                                <td>{{ stage.STAGE_DESC }}</td>
                                <td>{{ stage.dcount }}</td>
                                <td>20</td>
                              </tr>
                        {% endfor %}
                    </tbody>
				  </table>
		  </div>


	  </div>

	  <!-- 2nd row -->
	  <div class="container mt-3">
		  <button type="button" class="btn btn-primary dealflow-btn" data-toggle="collapse" data-target="#demo2"><img class="drp-arw" src="{% static 'img/arrow.png' %}"> Deals by Source</button>
			<div id="demo2" class="collapse mt-3">
			    <table class="table table-striped">
				    <thead>
				      <tr>
				        <th>DEADFLOW STAGE</th>
				        <th>COUNT</th>
				        <th>AVG DAYS</th>
				      </tr>
				    </thead>
				    <tbody>
				      <tr>
				        <td>New</td>
				        <td>81</td>
				        <td>20</td>
				      </tr>
				      <tr>
				        <td>New Interest</td>
				        <td>15</td>
				        <td>12</td>
				      </tr>
				      <tr>
				        <td>On hold</td>
				        <td>20</td>
				        <td></td>
				      </tr>
				    </tbody>
				  </table>
		  </div>
		</div>

		<!-- 3rd row -->
		<div class="container mt-3">
		  <button type="button" class="btn btn-primary dealflow-btn" data-toggle="collapse" data-target="#demo3"><img class="drp-arw" src="{% static 'img/arrow.png' %}"> Ask Metrics</button>
		   <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
		      THROUGHPUT: 12 DAYS 
		    </button>

		  
		    <div class="dropdown-menu">
		      <a class="dropdown-item" href="#">Link 1</a>
		      <a class="dropdown-item" href="#">Link 2</a>
		      <a class="dropdown-item" href="#">Link 3</a>
		    </div>
			<div id="demo3" class="collapse mt-3">
			    <table class="table table-striped">
				   <thead>
				      <tr>
				        <th>DEADFLOW STAGE</th>
				        <th>COUNT</th>
				        <th>AVG DAYS</th>
				      </tr>
				    </thead>
				    <tbody>
				      <tr>
				        <td>New</td>
				        <td>81</td>
				        <td>20</td>
				      </tr>
				      <tr>
				        <td>New Interest</td>
				        <td>15</td>
				        <td>12</td>
				      </tr>
				      <tr>
				        <td>On hold</td>
				        <td>20</td>
				        <td></td>
				      </tr>
				    </tbody>
				  </table>
		  </div>
		</div>
	</div>
	  <div class="col-lg-7 col-md-12 col-sm-12">
	  	<div id="chart" align="center"></div>
	  </div>
	</div>
	</div>
</div>


	
    <script>
    var timerInterval = 1500;

    var donut = donutChart()
        .width(980)
        .height(500)
        .transTime(750) // length of transitions in ms
        .cornerRadius(3) // sets how rounded the corners are on each slice
        .padAngle(0.015) // effectively dictates the gap between slices
        .variable('prob')
        .category('species');

    var i = 0;

    d3.tsv('static/species.tsv', function(error, data) {
        if (error) throw error;

        // group entries together by timestamp to simulate  receiving real-time data
        var nestData = d3.nest()
            .key(function(d) { return d.time; }) // collects entries with the same time value
            .entries(data);

        // timer to update chart with new data every timeInterval milliseconds.
        var timer = setInterval(function() {
        	if (i === nestData.length - 1) { clearInterval(timer); }
        	donut.data(nestData[i].values);
            if (i === 0) { // if first time receiving data...
                i++;
                d3.select('#chart')
                    .call(donut); // draw chart in div
            }
            i++;
        }, timerInterval);
    });
</script>

<!-- <script>
	$(function(){
    var $container = $('#chart'),
        τ = 2 * Math.PI,
        width = $container.width(),
        height = $container.height(),
        outerRadius = Math.min(width,height)/2,
        innerRadius = (outerRadius/5)*4,
        fontSize = (Math.min(width,height)/4);
    
    var arc = d3.svg.arc()
        .innerRadius(innerRadius)
        .outerRadius(outerRadius)
        .startAngle(0);

    var svg = d3.select('#chart').append("svg")
        .attr("width", '100%')
        .attr("height", '100%')
        .attr('viewBox','0 0 '+Math.min(width,height) +' '+Math.min(width,height) )
        .attr('preserveAspectRatio','xMinYMin')
        .append("g")
        .attr("transform", "translate(" + Math.min(width,height) / 2 + "," + Math.min(width,height) / 2 + ")");

    var text = svg.append("text")
        .text('0%')
        .attr("text-anchor", "middle")
        .style("font-size",fontSize+'px')
        .attr("dy",fontSize/3)
        .attr("dx",2);
    
    var background = svg.append("path")
        .datum({endAngle: τ})
        .style("fill", "#7cc35f")
        .attr("d", arc);

    var foreground = svg.append("path")
        .datum({endAngle: 0 * τ})
        .style("fill", "#57893e")
        .attr("d", arc);

    setInterval(function() {
      foreground.transition()
          .duration(750)
          .call(arcTween, Math.random() * τ);
    }, 1500);

    function arcTween(transition, newAngle) {

        transition.attrTween("d", function(d) {
    
            var interpolate = d3.interpolate(d.endAngle, newAngle);
            
            return function(t) {
                
                d.endAngle = interpolate(t);
                
                text.text(Math.round((d.endAngle/τ)*100)+'%');
                
                return arc(d);
            };
        });
    }
});
</script> -->
</body>
</html>